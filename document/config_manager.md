# ConfigManager

## Назначение
Управляет конфигурацией приложения в формате TOML. Обеспечивает загрузку и сохранение настроек, а также удобные методы для управления локалью, цветами и горячими клавишами.

## Расположение конфигурации
Конструктор принимает путь (файл или директорию) и нормализует его:
- относительные пути разрешаются относительно платформенного корня (APPDATA/LOCALAPPDATA на Windows, `~/Library/Application Support` на macOS, `$XDG_CONFIG_HOME` или `~/.config` на Linux);
- если передана директория, автоматически добавляется `config.toml`;
- если отсутствует расширение, добавляется `.toml`.
Итоговый путь сохраняется как `config_file_path_` в абсолютном виде.

## Хранимые данные
- `config_data_` — объект `toml::table`, содержащий всю конфигурацию в памяти.
Структура TOML разделена на логические разделы:
- `general.locale` — текущая локаль интерфейса;
- `colors.<element>` — цвета элементов UI;
- `keys.<action>` — привязки горячих клавиш.

## Жизненный цикл
- `load()` очищает текущее состояние, создаёт директорию при необходимости и пытается распарсить TOML-файл. Ошибки парсинга журналируются в `std::cerr`, после чего используется пустая таблица.
- `save()` создаёт родительскую директорию (если её нет) и сериализует `config_data_` обратно в файл.

## Публичные методы
- `set_locale/get_locale` — устанавливают или читают `general.locale`. Передача пустой строки удаляет ключ и, при необходимости, весь раздел `general`.
- `set_color/get_color` — управляют цветами элементов внутри таблицы `colors`.
- `set_key/get_key` — управляют горячими клавишами в таблице `keys`.

## Особенности реализации
- Вспомогательные функции `EnsureTable` и `FindTable` гарантируют наличие вложенных таблиц и помогают избегать дублирования кода.
- Все файловые операции выполняются через инструменты `FileManager`, что упрощает тестирование и делает код устойчивым к ошибкам файловой системы.

## Как использовать
1. Создайте `ConfigManager`, указав путь или имя папки, где хранится конфигурация.
2. Вызовите `load()`, чтобы прочитать существующие настройки (если файл отсутствует — будет создана пустая конфигурация).
3. Манипулируйте отдельными настройками через `set_locale`, `set_color`, `set_key` и соответствующие методы чтения.
4. После изменений вызовите `save()`, чтобы записать конфигурацию в файл.

### Пример использования
```cpp
ConfigManager config("fast_calc");
config.load();

if (config.get_locale().empty()) {
    config.set_locale("ru-RU");
}

config.set_color("result", "#00ff00");
config.set_key("toggle_history", "Ctrl+H");

config.save();
```
> В примере путь `fast_calc` трактуется как каталог внутри платформоспецифического конфиг-директория; итоговый файл будет создан как `.../fast_calc/config.toml`.
